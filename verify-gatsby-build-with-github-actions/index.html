<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.28b715d0c0238008b3e5.css" id="gatsby-global-css">:root{--reach-skip-nav:1}[data-reach-skip-nav-link]{border:0;clip:rect(0 0 0 0);height:1px;width:1px;margin:-1px;padding:0;overflow:hidden;position:absolute}[data-reach-skip-nav-link]:focus{padding:1rem;position:fixed;top:10px;left:10px;background:#fff;z-index:1;width:auto;height:auto;clip:auto}</style><meta name="generator" content="Gatsby 2.30.1"/><title data-react-helmet="true">Verify Gatsby Build with GitHub Actions | ozbe</title><meta data-react-helmet="true" name="description" content="Automatically run Gatsby build on feature branch pushes and prevent feature branches with broken builds from merging into the release branch…"/><meta data-react-helmet="true" property="og:title" content="Verify Gatsby Build with GitHub Actions"/><meta data-react-helmet="true" property="og:description" content="Automatically run Gatsby build on feature branch pushes and prevent feature branches with broken builds from merging into the release branch…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:creator" content="Josh Aaseby"/><meta data-react-helmet="true" name="twitter:title" content="Verify Gatsby Build with GitHub Actions"/><meta data-react-helmet="true" name="twitter:description" content="Automatically run Gatsby build on feature branch pushes and prevent feature branches with broken builds from merging into the release branch…"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-25d235bc2401c325ecef.js"/><link as="script" rel="preload" href="/styles-9411612e31e4f14527d1.js"/><link as="script" rel="preload" href="/framework-3e6dec6139dadaa7d0c7.js"/><link as="script" rel="preload" href="/app-01f6ee536d0106556fae.js"/><link as="script" rel="preload" href="/commons-380a30ce5f5e42c12471.js"/><link as="script" rel="preload" href="/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-54da6afa203fb26fe3d9.js"/><link as="fetch" rel="preload" href="/page-data/verify-gatsby-build-with-github-actions/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2744905544.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3090755652.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/386998304.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/764694655.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>(function() { try {
  var mode = localStorage.getItem('theme-ui-color-mode');
  if (!mode) return
  document.body.classList.add('theme-ui-' + mode);
} catch (e) {} })();</script><div id="___gatsby"><style data-emotion-css="9hecd0">body{color:#000;background-color:#fff;}</style><style data-emotion-css="1fthmpb">*{box-sizing:border-box;}body{margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;line-height:1.5;font-weight:400;}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="1a73ng7">.css-1a73ng7{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;line-height:1.5;font-weight:400;}</style><div class="css-1a73ng7"><header><style data-emotion-css="1ufxd81">.css-1ufxd81{max-width:672px;margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px;padding-top:32px;}</style><div class="css-1ufxd81"><style data-emotion-css="4c94nt">.css-4c94nt{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:32px;}</style><div class="css-4c94nt"><style data-emotion-css="1qd1r5f">.css-1qd1r5f{margin-top:0;margin-bottom:0;}</style><style data-emotion-css="t7wkbv">.css-t7wkbv{color:var(--theme-ui-colors-text,#000);font-family:inherit;line-height:1.125;font-weight:700;font-size:20px;margin-top:0;margin-bottom:0;}</style><p class="css-t7wkbv"><style data-emotion-css="lu49n7">.css-lu49n7{box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:var(--theme-ui-colors-primary,#07c);}</style><style data-emotion-css="1d0kooh">.css-1d0kooh{color:var(--theme-ui-colors-primary,#07c);box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:var(--theme-ui-colors-primary,#07c);}</style><a class="css-1d0kooh" href="/">ozbe</a></p></div></div></header><div id="reach-skip-nav" data-reach-skip-nav-content=""></div><div><style data-emotion-css="4u3j6r">.css-4u3j6r{max-width:672px;margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px;padding-bottom:32px;}</style><div class="css-4u3j6r"><main><article><header><style data-emotion-css="j9bg4">.css-j9bg4{color:var(--theme-ui-colors-text,#000);font-family:inherit;line-height:1.125;font-weight:700;font-size:32px;}</style><h1 class="css-j9bg4">Verify Gatsby Build with GitHub Actions</h1><style data-emotion-css="1h1xv8c">.css-1h1xv8c{font-size:14px;margin-top:-16px;margin-bottom:16px;}</style><style data-emotion-css="12skgw4">.css-12skgw4{color:var(--theme-ui-colors-text,#000);font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;font-weight:400;line-height:1.5;font-size:14px;margin-top:-16px;margin-bottom:16px;}</style><p class="css-12skgw4">May 20, 2020</p></header><section><style data-emotion-css="h0e33p">.css-h0e33p{color:var(--theme-ui-colors-text,#000);font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;font-weight:400;line-height:1.5;}</style><p class="css-h0e33p">Automatically run Gatsby build on feature branch pushes and prevent feature branches with broken builds from merging into the release branch.</p><style data-emotion-css="12datf4">.css-12datf4{color:var(--theme-ui-colors-text,#000);font-family:inherit;line-height:1.125;font-weight:700;font-size:24px;}</style><style data-emotion-css="10cps2a">.css-10cps2a{pointer-events:painted;color:var(--theme-ui-colors-text,#000);font-family:inherit;line-height:1.125;font-weight:700;font-size:24px;}.css-10cps2a a{visibility:hidden;}.css-10cps2a:hover a{visibility:visible;}</style><h2 id="tldr" class="css-10cps2a"><style data-emotion-css="1xo505e">.css-1xo505e{margin-left:-20px;padding-right:4px;color:var(--theme-ui-colors-primary,#07c);}</style><a href="#tldr" aria-label="tl;dr" class="css-1xo505e"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>tl;dr</h2><p class="css-h0e33p">You can see the code changes here <style data-emotion-css="1qljzjn">.css-1qljzjn{color:var(--theme-ui-colors-primary,#07c);}</style><a href="https://github.com/ozbe/ozbe.github.io/pull/2" class="css-1qljzjn">Verify Gatsby build succeeds on branches by ozbe · Pull Request #2 · ozbe/ozbe.github.io · GitHub</a></p><h2 id="background" class="css-10cps2a"><a href="#background" aria-label="Background" class="css-1xo505e"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Background</h2><p class="css-h0e33p">While working on adding RSS to ozbe.io in a feature branch, I nearly merged some changes that would have broken the build in the release branch. As discussed in <a href="https://ozbe.io/ozbe-io-rises/" class="css-1qljzjn">ozbe.io Rises</a>, changes pushed to the release branch, <code class="css-0">gatsby</code>, are automatically built and published, that includes changes that come from a merge request.</p><p class="css-h0e33p">Thankfully the GitHub Actions workflow would have stopped on the broken build and not published the broken changes. The worst that could happen would be that I have to make a hot-fix and hang my head in shame.</p><blockquote class="css-0"><p class="css-h0e33p"><em class="css-0">TANGENT</em> At a prior company I worked at, when you broke production, you were given a toilet brush that we passed around. It was intended to say, “Go clean the toilets.” Don’t worry though, the toilet brush was never used; merely symbolic. </p></blockquote><h2 id="overview" class="css-10cps2a"><a href="#overview" aria-label="Overview" class="css-1xo505e"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h2><p class="css-h0e33p">We are going to have to make two changes to avoid merging build breaking changes into the release branch. First, we are going to have to run the build for all branches. Secondly, we are going to have to protect the release branch from the build breaking changes.</p><h2 id="pre-reqs" class="css-10cps2a"><a href="#pre-reqs" aria-label="Pre-reqs" class="css-1xo505e"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pre-reqs</h2><p class="css-h0e33p">This post assumes a basic understanding of <a href="https://help.github.com/en/actions" class="css-1qljzjn">GitHub Actions</a>  and <a href="https://www.gatsbyjs.org/" class="css-1qljzjn">Gatsby</a>. If you know of GitHub Actions workflows and that Gatsby builds webpages, you should be good. </p><h2 id="build-all-the-branches" class="css-10cps2a"><a href="#build-all-the-branches" aria-label="Build all the branches" class="css-1xo505e"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Build all the branches</h2><p class="css-h0e33p"><a href="https://github.com/ozbe/ozbe.github.io" class="css-1qljzjn">ozbe.github.io</a> uses <a href="https://github.com/enriikke/gatsby-gh-pages-action/blob/master/README.md" class="css-1qljzjn">enriikke/gatsby-gh-pages-action</a> to build and publish the <code class="css-0">gatsby</code> branch. Here is the repo’s publish workflow that uses the action:</p><style data-emotion-css="vm6h8e">.css-vm6h8e{font-family:Menlo,monospace;overflow-x:auto;color:#393A34;background-color:#f6f8fa;}.css-vm6h8e code{color:inherit;}.css-vm6h8e .comment,.css-vm6h8e .prolog,.css-vm6h8e .doctype,.css-vm6h8e .cdata{color:#999988;font-style:italic;}.css-vm6h8e .namespace{opacity:0.7;}.css-vm6h8e .string,.css-vm6h8e .attr-value{color:#e3116c;}.css-vm6h8e .punctuation,.css-vm6h8e .operator{color:#393A34;}.css-vm6h8e .entity,.css-vm6h8e .url,.css-vm6h8e .symbol,.css-vm6h8e .number,.css-vm6h8e .boolean,.css-vm6h8e .variable,.css-vm6h8e .constant,.css-vm6h8e .property,.css-vm6h8e .regex,.css-vm6h8e .inserted{color:#36acaa;}.css-vm6h8e .atrule,.css-vm6h8e .keyword,.css-vm6h8e .attr-name,.css-vm6h8e .selector{color:#00a4db;}.css-vm6h8e .function,.css-vm6h8e .deleted,.css-vm6h8e .tag{color:#d73a49;}.css-vm6h8e .function-variable{color:#6f42c1;}.css-vm6h8e .tag,.css-vm6h8e .selector,.css-vm6h8e .keyword{color:#00009f;}.css-vm6h8e .highlight{background:hsla(0,0%,70%,.5);}</style><style data-emotion-css="1q7q4hh">.css-1q7q4hh{font-family:Menlo,monospace;font-size:inherit;}</style><style data-emotion-css="1e94kr5">.css-1e94kr5{font-family:Menlo,monospace;overflow-x:auto;color:#393A34;background-color:#f6f8fa;font-family:Menlo,monospace;font-size:inherit;}.css-1e94kr5 code{color:inherit;}.css-1e94kr5 .comment,.css-1e94kr5 .prolog,.css-1e94kr5 .doctype,.css-1e94kr5 .cdata{color:#999988;font-style:italic;}.css-1e94kr5 .namespace{opacity:0.7;}.css-1e94kr5 .string,.css-1e94kr5 .attr-value{color:#e3116c;}.css-1e94kr5 .punctuation,.css-1e94kr5 .operator{color:#393A34;}.css-1e94kr5 .entity,.css-1e94kr5 .url,.css-1e94kr5 .symbol,.css-1e94kr5 .number,.css-1e94kr5 .boolean,.css-1e94kr5 .variable,.css-1e94kr5 .constant,.css-1e94kr5 .property,.css-1e94kr5 .regex,.css-1e94kr5 .inserted{color:#36acaa;}.css-1e94kr5 .atrule,.css-1e94kr5 .keyword,.css-1e94kr5 .attr-name,.css-1e94kr5 .selector{color:#00a4db;}.css-1e94kr5 .function,.css-1e94kr5 .deleted,.css-1e94kr5 .tag{color:#d73a49;}.css-1e94kr5 .function-variable{color:#6f42c1;}.css-1e94kr5 .tag,.css-1e94kr5 .selector,.css-1e94kr5 .keyword{color:#00009f;}.css-1e94kr5 .highlight{background:hsla(0,0%,70%,.5);}</style><pre class="prism-code language-css-1q7q4hh css-1e94kr5"><div class="token-line"><span class="token plain"># .github/workflow/publish.yml</span></div><div class="token-line"><style data-emotion-css="1baulvz">.css-1baulvz{display:inline-block;}</style><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain">name: Gatsby Publish</span></div><div class="token-line"><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain">on:</span></div><div class="token-line"><span class="token plain">  push:</span></div><div class="token-line"><span class="token plain">    branches:</span></div><div class="token-line"><span class="token plain">      - gatsby</span></div><div class="token-line"><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain">jobs:</span></div><div class="token-line"><span class="token plain">  build:</span></div><div class="token-line"><span class="token plain">    runs-on: ubuntu-latest</span></div><div class="token-line"><span class="token plain">    steps:</span></div><div class="token-line"><span class="token plain">      - uses: actions/checkout@v1</span></div><div class="token-line"><span class="token plain">      - uses: enriikke/gatsby-gh-pages-action@v2</span></div><div class="token-line"><span class="token plain">        with:</span></div><div class="token-line"><span class="token plain">          access-token: ${{ secrets.ACCESS_TOKEN }}</span></div></pre><p class="css-h0e33p">We want to keep the same behavior for the <code class="css-0">gatsby</code> branch and we also want to run the build part for all other branches when they are pushed. The difference being, <em class="css-0">we don’t want to publish feature branches</em>. Maybe the GitHub Action we are already using already can help us out?</p><p class="css-h0e33p">//giphy spinning batman logo/</p><p class="css-h0e33p">Navigating over to <a href="https://github.com/enriikke/gatsby-gh-pages-action/blob/master/README.md" class="css-1qljzjn">enriikke/gatsby-gh-pages-action</a>, there is the option <code class="css-0">skip-publish</code> that looks very relevant to what we want to do. Here is an excerpt from the README:</p><pre class="language-text prism-code language-text css-1e94kr5"><div class="token-line"><span class="token plain">*skip-publish*: Builds your Gatsby site but skips publishing by setting it to true, effectively performing a test of the build process using the live configuration. Provided as an  [input](https://help.github.com/en/actions/automating-your-workflow-with-github-actions/creating-and-using-encrypted-secrets#using-encrypted-secrets-in-a-workflow)  Defaults to *false*</span></div></pre><p class="css-h0e33p">Perfect. We can use this /knob/ to control whether or not a branch is published. </p><p class="css-h0e33p">We could fork the publish workflow into a separate build workflow. It would build any branch that isn’t the release branch and have <code class="css-0">skip-publish</code> set to <code class="css-0">true</code>. But let’s try to avoid that duplication and use another GitHub Actions feature: expressions. </p><p class="css-h0e33p"><a href="https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions" class="css-1qljzjn">Expressions</a> in GitHub Actions allow us to programmatically set variables in a workflow. An expression looks like <code class="css-0">${{ &lt;expression&gt; }}</code>. If you’ve used something like <a href="https://handlebarsjs.com/" class="css-1qljzjn">Handlebars</a> or another templating technology, this should be fairly familiar to you. </p><p class="css-h0e33p">There is already an example of an expression in the <code class="css-0">publish.yml</code> above:</p><pre class="prism-code language-css-1q7q4hh css-1e94kr5"><div class="token-line"><span class="token plain"># ...</span></div><div class="token-line"><span class="token plain">    access-token: ${{ secrets.ACCESS_TOKEN }}</span></div><div class="token-line"><span class="token plain"># ...</span></div></pre><p class="css-h0e33p">Within an expression we have access to various contexts. These contexts enable us to access various information about the workflow, environment, and <a href="https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context" class="css-1qljzjn">more</a>.</p><p class="css-h0e33p">For our purposes, we want to set <code class="css-0">skip-publish</code> to <code class="css-0">true</code> when the workflow is running for the <code class="css-0">gatsby</code> branch and <code class="css-0">false</code> for all other branches.  Looking through the documentation we can see that the <code class="css-0">github</code> context has a property named <code class="css-0">ref</code>. <code class="css-0">github.ref</code>equals “<!-- -->[t]<!-- -->he branch or tag ref that triggered the workflow run.” </p><p class="css-h0e33p">We don’t know the names of all our feature branches, so we will write a boolean expression that will return true for all branches other than the release branch. Here is the expression:</p><pre class="prism-code language-css-1q7q4hh css-1e94kr5"><div class="token-line"><span class="token plain">github.ref != &#x27;refs/heads/gatsby&#x27;</span></div></pre><blockquote class="css-0"><p class="css-h0e33p"><em class="css-0">NOTE</em> If you just went, “Why is it <code class="css-0">refs/heads/gatsby</code> and not <code class="css-0">gatsby</code>?” Let me refer you to <a href="https://git-scm.com/book/en/v2/Git-Internals-Git-References" class="css-1qljzjn">Git - Git References</a> and <a href="https://developer.github.com/v3/git/refs/" class="css-1qljzjn">Git Refs | GitHub Developer Guide</a> to learn more about Git references. For now, just trust me that we need the <code class="css-0">refs/heads/</code>.</p></blockquote><p class="css-h0e33p">We now have our /knob/ and we have our boolean expression, so lets add them to <code class="css-0">publish.yml</code></p><pre class="prism-code language-css-1q7q4hh css-1e94kr5"><div class="token-line"><span class="token plain"># ...</span></div><div class="token-line"><span class="token plain">jobs:</span></div><div class="token-line"><span class="token plain">  build:</span></div><div class="token-line"><span class="token plain">    runs-on: ubuntu-latest</span></div><div class="token-line"><span class="token plain">    steps:</span></div><div class="token-line"><span class="token plain">      - uses: actions/checkout@v1</span></div><div class="token-line"><span class="token plain">      - uses: enriikke/gatsby-gh-pages-action@v2</span></div><div class="token-line"><span class="token plain">        with:</span></div><div class="token-line"><span class="token plain">          access-token: ${{ secrets.ACCESS_TOKEN }}</span></div><div class="token-line"><span class="token plain">          skip-publish: ${{ github.ref != &#x27;refs/heads/gatsby&#x27; }}</span></div></pre><p class="css-h0e33p">Great! Now <code class="css-0">gatsby-gh-pages-action</code> will only publish on our release branch.</p><p class="css-h0e33p">If we tried to push code to a branch with this workflow, we’d notice that the workflow doesn’t run. That is because we need to change one more thing in our workflow. </p><p class="css-h0e33p">Right now the publish workflow only runs on pushes to the <code class="css-0">gatsby</code> branch:</p><pre class="prism-code language-css-1q7q4hh css-1e94kr5"><div class="token-line"><span class="token plain">on:</span></div><div class="token-line"><span class="token plain">  push:</span></div><div class="token-line"><span class="token plain">    branches:</span></div><div class="token-line"><span class="token plain">      - gatsby</span></div></pre><p class="css-h0e33p">A quick visit to the <a href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#filter-pattern-cheat-sheet" class="css-1qljzjn">GitHub Action Workflow Filter pattern cheat sheet</a> will tell us we simply need to change <code class="css-0">gatsby</code> to <code class="css-0">&#x27;**&#x27;</code>.</p><pre class="prism-code language-css-1q7q4hh css-1e94kr5"><div class="token-line"><span class="token plain">on:</span></div><div class="token-line"><span class="token plain">  push:</span></div><div class="token-line"><span class="token plain">    branches:</span></div><div class="token-line"><span class="token plain">      - &#x27;**&#x27;</span></div></pre><p class="css-h0e33p">Now our publish workflow should meet our requirements and should look like this:</p><pre class="prism-code language-css-1q7q4hh css-1e94kr5"><div class="token-line"><span class="token plain">name: Gatsby Publish</span></div><div class="token-line"><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain">on:</span></div><div class="token-line"><span class="token plain">  push:</span></div><div class="token-line"><span class="token plain">    branches:</span></div><div class="token-line"><span class="token plain">      - &#x27;**&#x27;</span></div><div class="token-line"><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain">jobs:</span></div><div class="token-line"><span class="token plain">  build:</span></div><div class="token-line"><span class="token plain">    runs-on: ubuntu-latest</span></div><div class="token-line"><span class="token plain">    steps:</span></div><div class="token-line"><span class="token plain">      - uses: actions/checkout@v1</span></div><div class="token-line"><span class="token plain">      - uses: enriikke/gatsby-gh-pages-action@v2</span></div><div class="token-line"><span class="token plain">        with:</span></div><div class="token-line"><span class="token plain">          access-token: ${{ secrets.ACCESS_TOKEN }}</span></div><div class="token-line"><span class="token plain">          skip-publish: ${{ github.ref != &#x27;refs/heads/gatsby&#x27; }}</span></div></pre><blockquote class="css-0"><p class="css-h0e33p"><em class="css-0">TANGENT</em> One could argue we should rename the publish workflow, as its responsibilities have slightly changed. I’m going to leave it for now. </p></blockquote><h2 id="protect-the-release-branch" class="css-10cps2a"><a href="#protect-the-release-branch" aria-label="Protect the release branch" class="css-1xo505e"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Protect the release branch</h2><p class="css-h0e33p">Although the build will run for each branch on push, there is nothing stopping us from merging my branch in the release branch. To prevent merging a branch in the release branch, I need a setup a Branch protection rules.</p><p class="css-h0e33p"><a href="https://help.github.com/en/github/administering-a-repository/configuring-protected-branches" class="css-1qljzjn">Protected branches rules</a>  allow you to protect branches, from things such as a force push. They also allow you to enforce certain workflows, such as requiring that a particular status check passes before merging. I’d encourage you to read about the former and we are going to use the later for our purposes now.</p><blockquote class="css-0"><p class="css-h0e33p"><em class="css-0">NOTE</em> You need to be an owner or have admin permissions in a repository to customize branch protections. Chances are you won’t see <code class="css-0">Settings</code> if you got to <a href="https://github.com/ozbe/ozbe.github.io" class="css-1qljzjn">GitHub - ozbe/ozbe.github.io: Personal blog</a>.</p></blockquote><p class="css-h0e33p">Here is how we protect the release branch, from the repository’s GitHub page:
1) Select <code class="css-0">Settings</code>
2) On the left-hand side, select <code class="css-0">Branches</code>
3) Do you see the release branch listed in the <code class="css-0">Branch protection rules</code> table?
a) Yes,  submit the <code class="css-0">Edit</code> button on that row
b) No, submit the <code class="css-0">Add Rule</code>button to the right of <code class="css-0">Branch protection rules</code>
5) Under <code class="css-0">Protect matching branches</code>, check <code class="css-0">Require status checks to pass before merging </code>
6) Under the just checked <code class="css-0">Require status checks to pass before merging</code>, check <code class="css-0">build</code>
7) Submit the <code class="css-0">Save changes</code> button</p><p class="css-h0e33p">The page should look something like this:</p><p class="css-h0e33p"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1380px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:104.92753623188406%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACcElEQVQ4y51UiY6jMAzl/39upR2NNC30AsLZch8J11vbLZ1qtqvtDNKTkwCOn/1sy/cVXM9DGEY4uR4830cUxSiKAvwsy4LvPFZdN8iLElVdi2UUZYm27TDNM8ZpehnTNMOq6haeihBECdkQl7yEGWd0ekDbm2+hI1g1RXJwfYqsQt104H1PznptbvZVXJ1aVdNSdDGSc4YoOaPp9I+iW2FxmCrJJLq26zCMo+TiJxjHCdY0Lxjmv6vF1f0uZiqiVVQNXD+QwhxchaOnEBL1lfZqORX/g1DmZGYkFUHOKFDSJW1Puez5wx56oDQQk2cYp8+1oe8sphdSUba2g93+CGe3h03YbB3Yzg4fmy18klNRVjhfsrtW+eLHdUHWmIEdLrLxiLYKY4m0rGoSeiNiZ4HzT5csJyVcxLIDRkp7tuuZFGUVsdZaMI0D5mmkl1ztSSwn+5VHitIOgH2KsCFqG+eI932INyfAxt4TXRsfWxvO/iBRcKTpQ5RsOQ3rngMQyiX1LrceCzs+Fwjii9CLklQQ0rtLVkgailveSsrpfU0p4r308kz60cbIlFEqAE+fIAxl+vDa5zOloILwTn3V3FdIhPyS88RFOXk+jTIldoXrq/s5r1UQyRCRwknxauqyRvZS5avDSZrbGB4IGn3/CU3nHWlxII09dsXzoixXh0b3iONEaOUi7Ipyc9VWRessz8Fzky9kJRij76rgS0UJN0VYdB2yxlDLhUjTlHTXPkVDtGqm9wUdDRRuiF+/34WJOMwbTQ4DqmYk0fzrZz5/RC3Cb6WT7N2Bou152nB1RnnJmmJqwzAIvVfB1V3m6/j6Az6mU5LmIlq/AAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <style data-emotion-css="9whsf3">.css-9whsf3{max-width:100%;}</style><img class="gatsby-resp-image-image css-9whsf3" alt="Gatsby Branch Protection Rule" title="Gatsby Branch Protection Rule" src="/static/08f85f3f76c2e17bd1eaec5617fa68c5/b1001/gatsby-branch-protection-rule.png" srcSet="/static/08f85f3f76c2e17bd1eaec5617fa68c5/e4d6b/gatsby-branch-protection-rule.png 345w,/static/08f85f3f76c2e17bd1eaec5617fa68c5/1e043/gatsby-branch-protection-rule.png 690w,/static/08f85f3f76c2e17bd1eaec5617fa68c5/b1001/gatsby-branch-protection-rule.png 1380w,/static/08f85f3f76c2e17bd1eaec5617fa68c5/e4ee8/gatsby-branch-protection-rule.png 1496w" sizes="(max-width: 1380px) 100vw, 1380px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><blockquote class="css-0"><p class="css-h0e33p"><em class="css-0">NOTE</em> While the “Require pull request reviews before merging” isn’t checked here, it is a common best practice to require peer-reviews to merge changes into a release branch, commonly named <code class="css-0">master</code>. </p></blockquote><p class="css-h0e33p">That’s it! Now the build must pass before we can merge the related feature branch into the release branch. This should give us some more peace of mind. But remember, this doesn’t mean the code is free of bugs, typos, or unwanted content. We would need to run more elaborate testing to catch those kind of errors.</p></section><footer><div><hr class="css-0"/><style data-emotion-css="1xfq9zt">.css-1xfq9zt{-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;list-style:none;padding-left:0;padding-right:0;padding-top:8px;padding-bottom:8px;}</style><style data-emotion-css="12bcmkl">.css-12bcmkl{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;list-style:none;padding-left:0;padding-right:0;padding-top:8px;padding-bottom:8px;}</style><ul class="css-12bcmkl"><li><a rel="prev" class="css-1qljzjn" href="/what-im-reading-2020-05-17/">← <!-- -->What I&#x27;m Reading - 2020-05-17</a></li><li><a rel="next" class="css-1qljzjn" href="/what-im-reading-2020-05-25/">What I&#x27;m Reading - 2020-05-25<!-- --> →</a></li></ul><hr class="css-0"/></div><div><style data-emotion-css="gx0lhm">.css-gx0lhm{margin-bottom:0;}</style><style data-emotion-css="15wd6mo">.css-15wd6mo{color:var(--theme-ui-colors-text,#000);font-family:inherit;line-height:1.125;font-weight:700;font-size:24px;margin-bottom:0;}</style><h2 class="css-15wd6mo">Comments</h2><div class="comments"></div></div></footer></article></main><footer><hr class="css-0"/><style data-emotion-css="j6r63x">.css-j6r63x{margin-bottom:32px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style data-emotion-css="u5xevn">.css-u5xevn{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:32px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-u5xevn"><style data-emotion-css="1emx3y6">.css-1emx3y6{margin-right:8px;margin-bottom:0;width:48px;min-width:48px;border-radius:99999px;}</style><div class="css-1emx3y6 gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:48px;height:48px"><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEz0lEQVQ4ywHEBDv7AOqzV9CJLKZnIoBLH3E/GmY5HnFDJJZoOqyJXI97YYp6YLqdcd+4e9+/h/Do1N3EmM+ueNCxgM+wf8+vfgDjt2bitmDfrk7bpD/DiDJ9Og6FSRtcOh88KBw2KycvLzBBRESEcFXRs4Lh0KjZwpLWvIzTuYjRs4LQrHYA4rZz6bp157Vu47Bn15pJyIY+jnBUmHBYq31plXBfdFlLSD44LCgek4h17+LM0LiO0beM1LmKuJdoxqh+AOWtYuyvWeiwYNmucNihXHlVMYtkUNuegtKeis2jl72alZyAfFREPE9GNsvCntG7jsqxh8qtgcywh+3ToADUq3vGrYvYnljTpXHSpnRZOxyWZlDJh2rSnIjJoJbBnpy7m5utlZFmW1KlrYPdw4zQr33MrHzSrXnvtWAA06h52rWEy5lg2sq01adzbD8XnWpOvYVom3JgoX90lHlxdGdojIKHaF9djH9guaN8vaJ4v6R6z6Vs5qpaAMaFSs+PVJaEbZablcCcd1w/JWREM15DMiIdGkIzLEk9ODEzNFFRVlJMTHNlWnt4a5GKeoJ7b56DX9yVPwCjnXOtj1uhbDadoaGqtbhoST1vRS+XaEqEXESha1eigYR2ZGWJdnuOfoCGdXFsa16ckHmDemaTdk/clDwAn7q5j8m/rpd8xc3YvM7apGI7sW9QqXRlomlVkVQ/g2JliGdpknV7mYSJl4qKjpCFs6SGnpN5qo1k15BBAKSutZOZiZWtoMXa4bqvprdrKrt3TY5bP5ZeQ5FYQWNJSn9ma21WUYl5er25sZynqLSrlqqijruhf8qJRgCdeVCmhFamm3vPvaulwMu+gT6xbTmQXzaJVzR6QjNpQ0ZzXl9uX12HdGqwmXOMgW2fjHCUhXClimu+hlAAZFYpi4FkrI55k2xMQVRhl1sZ1J1rZUMwlmM/snZclnBtg3V0TkhIj2pEwYM3vYE8oWozgUsjn2Asunw9AHh6a4qnu493cCQbEw0OEhcSDYBbOWVBLy8fFG1PPG1ZUTAwLEpCP8e7ptbMsdLHrrebf19MP3taPrh4QQCVclOjpaqPdWkfFg0NEBQRExYQFRqNVDNEJBgSDAwZFA9CNjV6ZGdgXlqkpprOw665kYBXQkNgTj65i2YAkGlGkHtrnm9JPyYVFRgbGhobLSMesHBGp2NAXDgqb1hXgmxyjHR3MS0wBwsQPzs3jWZUh2lqclZLqnlVAJJ9b6CCco5wYjgmGxIVFwgMEEw3KsZ9SbNxTYVZSHZcXIt2e4ZxdC8vMwgLDgYKECAhIz42N0AYHmwwKQCVjpCEgopOVmAUFRYQEhYSEhQMEBRQNSKRWTqSbmNxXFZkVVgtKC0IDBEOEBUPEhYNEhYNEhguICVNKC4AQz5BJiUnExQYEhQXExQYFBUXDxEVCg4TGRUWKiQkIR8iDRAUCQ0SDhIWDQ8UDRAVERQXEBMXDBIXGBsgAB0eIBYZHhUXGxITFhIUFxITFw8RFRQUFw0OEQcJDQYJDAgKDQwOEgwRFQwQFA0QFAsNEA0RFBERFhESFgATFBcTFBcTFRgREhUXGBsVFxsNDhIMDRAfISQhJCgoKzE2OkEdIScLDhIMDxMODxIiJisRFBcNDhAQERSpF+JMq5NL2wAAAABJRU5ErkJggg==" alt="Josh Aaseby" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/984ae5788e11aa7339eee429c839a261/aff39/avatar.png 1x,
/static/984ae5788e11aa7339eee429c839a261/e5b88/avatar.png 1.5x,
/static/984ae5788e11aa7339eee429c839a261/88b72/avatar.png 2x" /><img loading="lazy" width="48" height="48" srcset="/static/984ae5788e11aa7339eee429c839a261/aff39/avatar.png 1x,
/static/984ae5788e11aa7339eee429c839a261/e5b88/avatar.png 1.5x,
/static/984ae5788e11aa7339eee429c839a261/88b72/avatar.png 2x" src="/static/984ae5788e11aa7339eee429c839a261/aff39/avatar.png" alt="Josh Aaseby" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><div class="css-0">Josh Aaseby<br/>Software Engineer</div></div></footer></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>window.goatcounter={no_onload:true,};</script><script async="" data-goatcounter="https://ozbe.goatcounter.com/count" src="https://gc.zgo.at/count.js"></script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/verify-gatsby-build-with-github-actions/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-eb0d07966faded618939.js"],"app":["/app-01f6ee536d0106556fae.js"],"component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js":["/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-54da6afa203fb26fe3d9.js"],"component---node-modules-gatsby-theme-blog-core-src-templates-posts-query-js":["/component---node-modules-gatsby-theme-blog-core-src-templates-posts-query-js-3894b0dcdef7cc533e5e.js"]};/*]]>*/</script><script src="/polyfill-eb0d07966faded618939.js" nomodule=""></script><script src="/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-54da6afa203fb26fe3d9.js" async=""></script><script src="/commons-380a30ce5f5e42c12471.js" async=""></script><script src="/app-01f6ee536d0106556fae.js" async=""></script><script src="/framework-3e6dec6139dadaa7d0c7.js" async=""></script><script src="/styles-9411612e31e4f14527d1.js" async=""></script><script src="/webpack-runtime-25d235bc2401c325ecef.js" async=""></script></body></html>