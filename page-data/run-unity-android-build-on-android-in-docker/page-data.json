{"componentChunkName":"component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js","path":"/run-unity-android-build-on-android-in-docker/","result":{"data":{"site":{"siteMetadata":{"title":"ozbe","social":[{"name":"twitter","url":"https://twitter.com/ozbe"},{"name":"github","url":"https://github.com/ozbe"},{"name":"linkedin","url":"https://www.linkedin.com/in/josh-aaseby"}]}},"blogPost":{"__typename":"MdxBlogPost","id":"51c93033-b748-5b54-9094-f72f892591c2","excerpt":"Steps to run a Unity Android Build (APK) on Android (Anbox) in Docker ( AinD ) on a Mac. Running Android builds in Docker can be tool for…","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Run Unity Android Build on Android in Docker\",\n  \"date\": \"2021-01-15T00:00:00.000Z\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Steps to run a Unity Android Build (APK) on Android (Anbox) in Docker (\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/aind-containers/aind\"\n  }), \"AinD\"), \") on a Mac. Running Android builds in Docker can be tool for testing locally and adapted to running in the cloud. \"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"PRO TIP Remember, while virtualization has its use cases, it is not an absolute substitute for testing on actual hardware. Put another way, if you don\\u2019t test on the actual device you\\u2019re going to release on, you\\u2019re probably going to have a bad time.  \")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"DISCLAIMER I formerly worked at Unity. While I no longer work there, I still have a vested interest in their success.\")), mdx(\"h2\", {\n    \"id\": \"overview\"\n  }, \"Overview\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#prereqs\"\n  }), \"Prereqs\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#build-unity-project\"\n  }), \"Build Unity Project\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#start-aind\"\n  }), \"Start AinD\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#run-unity-build-apk\"\n  }), \"Run Unity Build (APK)\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#shutdown\"\n  }), \"Shutdown\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#cleanup\"\n  }), \"Cleanup\"))), mdx(\"h2\", {\n    \"id\": \"prereqs\"\n  }, \"Prereqs\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Clone \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"the\"), \" project \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/ozbe/aind-unity-poc\"\n  }), \"GitHub - ozbe/aind-unity-poc: Steps to run a Unity Android Build in Android in Docker (AinD) on a Mac.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://unity3d.com/get-unity/download\"\n  }), \"Unity\"), \" with Android Build Support - Tested with version 2018.4.30f1 (LTS)\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"NOTE You may think you\\u2019re going to use 2019.3+ for this walkthrough, don\\u2019t. It looks  support for x86 was dropped in 2019.3  in favor of ARM64. Source: \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://blogs.unity3d.com/2019/03/05/android-support-update-64-bit-and-app-bundles-backported-to-2017-4-lts/\"\n  }), \"Android Support Update: 64 bit and App Bundles Backported to 2017.4 LTSUnity 2017.4 LTS  - Unity Technologies Blog\"), \".   \")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://www.virtualbox.org/wiki/Downloads\"\n  }), \"VirtualBox\"), \" - Tested with version 6.1.16\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://www.vagrantup.com/downloads.html\"\n  }), \"Vagrant\"), \" - Tested with version 2.2.14\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://developer.android.com/studio/\"\n  }), \"Android Studio \"), \" - Tested with version \"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://www.realvnc.com/en/connect/download/viewer/\"\n  }), \"VNC Viewer\"), \" - Tested with version 6.20.817\")), mdx(\"h2\", {\n    \"id\": \"build-unity-project\"\n  }, \"Build Unity Project\"), mdx(\"p\", null, \"The example Unity project shows a rotating cube on the screen for approximately 2 seconds and then exits. \"), mdx(\"p\", null, \"To an Android build of the project, follow the following steps, from the project root\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Open Unity project \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"./RotatingCube\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"File\"), \" > \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Build Settings\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Android\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Use all defaults\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Build\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Save APK as \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"./apk.d/rotatingcube.apk\"))), mdx(\"p\", null, \"We now have a build file (APK) that we can run with AinD.\"), mdx(\"h2\", {\n    \"id\": \"start-aind\"\n  }, \"Start AinD\"), mdx(\"p\", null, \"AinD requires some modules that are not available on macOS. To overcome these shortcomings, we will run AinD in an Ubuntu VM (Ubuntu being the version AinD\\u2019s author has tested AinD on).\"), mdx(\"p\", null, \"To simplify creating and provisioning the VM, the project provides a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Vagrantfile\"), \" to do the heavy lifting for us.\"), mdx(\"p\", null, \"In a terminal, at the project root., start the VM\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"$ vagrant up\\n\")), mdx(\"p\", null, \"After starting the VM, SSH into the VM\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"$ vagrant ssh\\n\")), mdx(\"p\", null, \"Inside the VM, we can run AinD with Docker\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"$ sudo docker run \\\\\\n   --rm \\\\\\n   -td \\\\\\n   --name aind \\\\\\n   --privileged \\\\\\n   -p 5900:5900 \\\\\\n   -v /vagrant/apk.d/:/apk.d/ \\\\\\n   -v /lib/modules:/lib/modules:ro \\\\\\n    aind/aind:0.0.3\\n\")), mdx(\"p\", null, \"There is a lot going on it the previous command. If you\\u2019re interested, let\\u2019s go break down each line:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"sudo docker run\"), \" execute the Docker run command as root\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"--rm \\\\\"), \" remove the container when it stops\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"-td \\\\\"), \" allocate a pseudo-TTY and run the container in the background\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"--name aind \\\\\"), \" name the container \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"aind\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"--privileged \\\\\"), \" Give the extended privileges required by AinD to this container\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"-p 5900:5900 \\\\\"), \" publish port 5900 to the host to connect via VNC\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"-v /vagrant/apk.d/:/apk.d/ \\\\\"), \" mount the projects \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"apk.d\"), \" folder to the container\\u2019s  \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"apk.d\"), \" folder, so our APK will be loaded automatically \"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"-v /lib/modules:/lib/modules:ro \\\\\"), \"Required by AinD\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"aind/aind:0.0.3\"), \" AinD image to run (0.0.3 being the latest version at the time of writing and using \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"latest\"), \" isn\\u2019t )\")), mdx(\"p\", null, \"After starting the AinD container we should wait for the container to report ready.  Tail the container logs and look for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Ready\"), \" (in ASCII art letters)\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"$ sudo docker logs -f aind\\n\")), mdx(\"p\", null, \"Now we have AinD running and our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rotatingcube.apk\"), \" should be loaded.  Before we move onto running APK, let\\u2019s get the VNC password we\\u2019ll need for the next step\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"sudo docker exec aind cat /home/user/.vnc/passwdfile\\n\")), mdx(\"p\", null, \"Copy the VNC password output and let\\u2019s run the APK.\"), mdx(\"h2\", {\n    \"id\": \"run-unity-build-apk\"\n  }, \"Run Unity Build (APK)\"), mdx(\"p\", null, \"To run the  \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rotatingcube.apk\"), \", ensure AinD is started and then\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Open VNC Viewer\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Connect to address: \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"127.0.0.1:5900\"), \" (ignore any unencrypted errors)\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Enter the password you copied from the last step of \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#start-aind\"\n  }), \"Start AinD\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Connect\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"When you connect to the server, the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Anbox Application Manager\"), \" window should be open\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Double-click on \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"RotatingCube\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"RotatingCube should appear for approx. 2 seconds and then close\")), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1380px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"80.28985507246377%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAADGElEQVQ4y3WTy08TURTGZ4ELJe6ML5LysO20nZkaNigvNTEKvkCjIG2x9D3Tmb5bfIFG0UQ0alz4J/gILty4IEhEBYJhQVxpFBMRDSEu1LWrz3PvtJQuXPzynXPPud89dx5CNKoiRhhxA4ZucE0aSagxFXpch6ZqiEaiXFkeCUWgxTTep6lxxMIReBJZHL80io4eDwSbzQqnLKHBKaKW4nrRDlGRIbpl2GjdSSoqEizWXbBKLlhdTr7u2K3wXFZcqNnfCaGjG0L1Rgii3Y7C1Wt4Mb+AZ1MzePZ6FmOkY69m8HTyDZ6/ncPzN3N4PPEaT14STCemKJ7CI9Kx8Uk00WRbzviwucEKoc5iwcj9B1j6C7xf/U38wcLKL8wv/8S7pVXMfvmB6c/LmCGmP30z40XGd8x9XcEcxY2nerHpRA+q68nQThOe7O7CpfMF5NJJTp5rArlUguJEOWdxhuqZFKeQy+AiYWneC2FPE6p2bIfgdDpxtOMQjEgAsUA/1CARKBP1exHu76Oar2KdEzyH+IAPtS3NENr3YcPOnRBcLgldRzuRjAWhhagh7EecaZGsHsVQIU31ADQ6LB4u1sJmr0GmlmYybGsrGbrQdawTicgAbfCZm0ImasCLifFxfPi4iLujt2jSXujMiHpYn0Y9Ok3Or9zWbhpKkowTRw4jEfWbhkUzrkEv7tx7iNzwfSRTBWgBz9phpV6DDuVXLk0oywqOc8PShCZxpmSQzxaQzg3BUFXTsFRbZ1jX2lI2VBQ3uvmVz9EGbwVsozrggTbQt2ZW0UM5M6xvay0bOukZMsNkxF88vX8dPuih8jOtrPv4GjdcP6HocKDz4AHE/GcR8p5B2GcS+g/hCnoQ9Zw2X0p78aXYbHZ4ek/j9sgVXB+6gJFhk+vDpfhiWa8UKdZuUHzz8iA9w+KVa2poQlGkP6Ub2WwGqVSSNItcLovBwUHk83mel8ik08hkMlTPmTmR0nVYWswrV23fBqGxsRGKosBms4F9k7Is85zBcgc9EkmSeJ3B/iy328372DAy1Wvpw9566iQ2WR34BxAUoCpieVicAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Rotatingcube Running\",\n    \"title\": \"Rotatingcube Running\",\n    \"src\": \"/static/bfefdebf4b9d9481262fb51653df3168/b1001/rotatingcube-running.png\",\n    \"srcSet\": [\"/static/bfefdebf4b9d9481262fb51653df3168/e4d6b/rotatingcube-running.png 345w\", \"/static/bfefdebf4b9d9481262fb51653df3168/1e043/rotatingcube-running.png 690w\", \"/static/bfefdebf4b9d9481262fb51653df3168/b1001/rotatingcube-running.png 1380w\", \"/static/bfefdebf4b9d9481262fb51653df3168/a6d66/rotatingcube-running.png 2070w\", \"/static/bfefdebf4b9d9481262fb51653df3168/8201f/rotatingcube-running.png 2554w\"],\n    \"sizes\": \"(max-width: 1380px) 100vw, 1380px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"p\", null, \"There you go. You ran a Unity Android build in Docker. \"), mdx(\"p\", null, \"To wrap up, we will shut the container and VM down and clean up the resources. That is unless you want to go on your own and try to run other APKs. For which you are on your own, though you have the comments to discuss.\"), mdx(\"h2\", {\n    \"id\": \"shutdown\"\n  }, \"Shutdown\"), mdx(\"p\", null, \"In the VM, stop the AinD\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"$ sudo docker stop aind\\n\")), mdx(\"p\", null, \"On the host, shutdown the VM\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"$ vagrant halt\\n\")), mdx(\"h2\", {\n    \"id\": \"cleanup\"\n  }, \"Cleanup\"), mdx(\"p\", null, \"In the terminal on host, destroy the VM\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"$ vagrant destroy -f\\n\")), mdx(\"h2\", {\n    \"id\": \"conclusion\"\n  }, \"Conclusion\"), mdx(\"p\", null, \"Now that you have run the example project\\u2019s Unity Android build in Docker, I\\u2019d recommend you check out \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/aind-containers/aind\"\n  }), \"GitHub - aind-containers/aind: AinD: Android in Docker. Ain\\u2019t an emulator.\"), \" to get guidance on how you can run the same build or another in the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"cloud\"), \".\"));\n}\n;\nMDXContent.isMDXComponent = true;","slug":"/run-unity-android-build-on-android-in-docker/","title":"Run Unity Android Build on Android in Docker","tags":[],"date":"January 15, 2021","image":null,"imageAlt":null,"imageCaptionText":null,"imageCaptionLink":null,"socialImage":null},"previous":{"__typename":"MdxBlogPost","id":"0f066a65-d3c4-54ba-b87c-3a80ceb0366b","excerpt":"Everyday and obscure (yet helpful) commands and references I use when working in the command line. While I have some of these memorized…","slug":"/command-line-cheat-sheet/","title":"Command Line Cheat Sheet","date":"January 09, 2021"},"next":{"__typename":"MdxBlogPost","id":"971233dd-f8c5-53fd-8985-dff7c761d0f1","excerpt":"Gather and share feedback from your direct report’s peers. Celebrate with them what others see as their accomplishments and work together to…","slug":"/request-peer-feedback/","title":"Request Peer Feedback","date":"January 18, 2021"}},"pageContext":{"id":"51c93033-b748-5b54-9094-f72f892591c2","previousId":"0f066a65-d3c4-54ba-b87c-3a80ceb0366b","nextId":"971233dd-f8c5-53fd-8985-dff7c761d0f1","maxWidth":1380}},"staticQueryHashes":["2744905544","3090755652","386998304","764694655"]}